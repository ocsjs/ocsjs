function E(){return E=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},E.apply(this,arguments)}function k(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,M(e,r)}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},L(e)}function M(e,r){return M=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},M(e,r)}function ee(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function $(e,r,n){return ee()?$=Reflect.construct:$=function(i,f,a){var u=[null];u.push.apply(u,f);var O=Function.bind.apply(i,u),p=new O;return a&&M(p,a.prototype),p},$.apply(null,arguments)}function re(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function B(e){var r=typeof Map=="function"?new Map:void 0;return B=function(t){if(t===null||!re(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(t))return r.get(t);r.set(t,i)}function i(){return $(t,arguments,L(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),M(i,t)},B(e)}var te=/%[sdj%]/g,ne=function(){};typeof process!="undefined"&&process.env;function J(e){if(!e||!e.length)return null;var r={};return e.forEach(function(n){var t=n.field;r[t]=r[t]||[],r[t].push(n)}),r}function v(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var t=1,i=r[0],f=r.length;if(typeof i=="function")return i.apply(null,r.slice(1));if(typeof i=="string"){var a=String(i).replace(te,function(u){if(u==="%%")return"%";if(t>=f)return u;switch(u){case"%s":return String(r[t++]);case"%d":return Number(r[t++]);case"%j":try{return JSON.stringify(r[t++])}catch(O){return"[Circular]"}break;default:return u}});return a}return i}function ie(e){return e==="string"||e==="url"||e==="hex"||e==="email"||e==="date"||e==="pattern"}function y(e,r){return!!(e==null||r==="array"&&Array.isArray(e)&&!e.length||ie(r)&&typeof e=="string"&&!e)}function fe(e,r,n){var t=[],i=0,f=e.length;function a(u){t.push.apply(t,u),i++,i===f&&n(t)}e.forEach(function(u){r(u,a)})}function G(e,r,n){var t=0,i=e.length;function f(a){if(a&&a.length){n(a);return}var u=t;t=t+1,u<i?r(e[u],f):n([])}f([])}function ae(e){var r=[];return Object.keys(e).forEach(function(n){r.push.apply(r,e[n])}),r}var H=function(e){k(r,e);function r(n,t){var i;return i=e.call(this,"Async Validation Error")||this,i.errors=n,i.fields=t,i}return r}(B(Error));function se(e,r,n,t){if(r.first){var i=new Promise(function(h,w){var x=function(g){return t(g),g.length?w(new H(g,J(g))):h()},P=ae(e);G(P,n,x)});return i.catch(function(h){return h}),i}var f=r.firstFields||[];f===!0&&(f=Object.keys(e));var a=Object.keys(e),u=a.length,O=0,p=[],m=new Promise(function(h,w){var x=function(o){if(p.push.apply(p,o),O++,O===u)return t(p),p.length?w(new H(p,J(p))):h()};a.length||(t(p),h()),a.forEach(function(P){var o=e[P];f.indexOf(P)!==-1?G(o,n,x):fe(o,n,x)})});return m.catch(function(h){return h}),m}function I(e){return function(r){return r&&r.message?(r.field=r.field||e.fullField,r):{message:typeof r=="function"?r():r,field:r.field||e.fullField}}}function Q(e,r){if(r){for(var n in r)if(r.hasOwnProperty(n)){var t=r[n];typeof t=="object"&&typeof e[n]=="object"?e[n]=E({},e[n],t):e[n]=t}}return e}function X(e,r,n,t,i,f){e.required&&(!n.hasOwnProperty(e.field)||y(r,f||e.type))&&t.push(v(i.messages.required,e.fullField))}function oe(e,r,n,t,i){(/^\s+$/.test(r)||r==="")&&t.push(v(i.messages.whitespace,e.fullField))}var U={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},T={integer:function(r){return T.number(r)&&parseInt(r,10)===r},float:function(r){return T.number(r)&&!T.integer(r)},array:function(r){return Array.isArray(r)},regexp:function(r){if(r instanceof RegExp)return!0;try{return!!new RegExp(r)}catch(n){return!1}},date:function(r){return typeof r.getTime=="function"&&typeof r.getMonth=="function"&&typeof r.getYear=="function"&&!isNaN(r.getTime())},number:function(r){return isNaN(r)?!1:typeof r=="number"},object:function(r){return typeof r=="object"&&!T.array(r)},method:function(r){return typeof r=="function"},email:function(r){return typeof r=="string"&&!!r.match(U.email)&&r.length<255},url:function(r){return typeof r=="string"&&!!r.match(U.url)},hex:function(r){return typeof r=="string"&&!!r.match(U.hex)}};function de(e,r,n,t,i){if(e.required&&r===void 0){X(e,r,n,t,i);return}var f=["integer","float","array","regexp","object","method","email","number","date","url","hex"],a=e.type;f.indexOf(a)>-1?T[a](r)||t.push(v(i.messages.types[a],e.fullField,e.type)):a&&typeof r!==e.type&&t.push(v(i.messages.types[a],e.fullField,e.type))}function ue(e,r,n,t,i){var f=typeof e.len=="number",a=typeof e.min=="number",u=typeof e.max=="number",O=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,p=r,m=null,h=typeof r=="number",w=typeof r=="string",x=Array.isArray(r);if(h?m="number":w?m="string":x&&(m="array"),!m)return!1;x&&(p=r.length),w&&(p=r.replace(O,"_").length),f?p!==e.len&&t.push(v(i.messages[m].len,e.fullField,e.len)):a&&!u&&p<e.min?t.push(v(i.messages[m].min,e.fullField,e.min)):u&&!a&&p>e.max?t.push(v(i.messages[m].max,e.fullField,e.max)):a&&u&&(p<e.min||p>e.max)&&t.push(v(i.messages[m].range,e.fullField,e.min,e.max))}var R="enum";function pe(e,r,n,t,i){e[R]=Array.isArray(e[R])?e[R]:[],e[R].indexOf(r)===-1&&t.push(v(i.messages[R],e.fullField,e[R].join(", ")))}function ce(e,r,n,t,i){if(e.pattern){if(e.pattern instanceof RegExp)e.pattern.lastIndex=0,e.pattern.test(r)||t.push(v(i.messages.pattern.mismatch,e.fullField,r,e.pattern));else if(typeof e.pattern=="string"){var f=new RegExp(e.pattern);f.test(r)||t.push(v(i.messages.pattern.mismatch,e.fullField,r,e.pattern))}}}var d={required:X,whitespace:oe,type:de,range:ue,enum:pe,pattern:ce};function ye(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r,"string")&&!e.required)return n();d.required(e,r,t,f,i,"string"),y(r,"string")||(d.type(e,r,t,f,i),d.range(e,r,t,f,i),d.pattern(e,r,t,f,i),e.whitespace===!0&&d.whitespace(e,r,t,f,i))}n(f)}function ge(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i),r!==void 0&&d.type(e,r,t,f,i)}n(f)}function he(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(r===""&&(r=void 0),y(r)&&!e.required)return n();d.required(e,r,t,f,i),r!==void 0&&(d.type(e,r,t,f,i),d.range(e,r,t,f,i))}n(f)}function me(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i),r!==void 0&&d.type(e,r,t,f,i)}n(f)}function le(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i),y(r)||d.type(e,r,t,f,i)}n(f)}function ve(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i),r!==void 0&&(d.type(e,r,t,f,i),d.range(e,r,t,f,i))}n(f)}function qe(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i),r!==void 0&&(d.type(e,r,t,f,i),d.range(e,r,t,f,i))}n(f)}function we(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(r==null&&!e.required)return n();d.required(e,r,t,f,i,"array"),r!=null&&(d.type(e,r,t,f,i),d.range(e,r,t,f,i))}n(f)}function be(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i),r!==void 0&&d.type(e,r,t,f,i)}n(f)}var Oe="enum";function xe(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i),r!==void 0&&d[Oe](e,r,t,f,i)}n(f)}function Pe(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r,"string")&&!e.required)return n();d.required(e,r,t,f,i),y(r,"string")||d.pattern(e,r,t,f,i)}n(f)}function Fe(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r,"date")&&!e.required)return n();if(d.required(e,r,t,f,i),!y(r,"date")){var u;r instanceof Date?u=r:u=new Date(r),d.type(e,u,t,f,i),u&&d.range(e,u.getTime(),t,f,i)}}n(f)}function Ae(e,r,n,t,i){var f=[],a=Array.isArray(r)?"array":typeof r;d.required(e,r,t,f,i,a),n(f)}function W(e,r,n,t,i){var f=e.type,a=[],u=e.required||!e.required&&t.hasOwnProperty(e.field);if(u){if(y(r,f)&&!e.required)return n();d.required(e,r,t,a,i,f),y(r,f)||d.type(e,r,t,a,i)}n(a)}function Ee(e,r,n,t,i){var f=[],a=e.required||!e.required&&t.hasOwnProperty(e.field);if(a){if(y(r)&&!e.required)return n();d.required(e,r,t,f,i)}n(f)}var V={string:ye,method:ge,number:he,boolean:me,regexp:le,integer:ve,float:qe,array:we,object:be,enum:xe,pattern:Pe,date:Fe,url:W,hex:W,email:W,required:Ae,any:Ee};function Z(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var r=JSON.parse(JSON.stringify(this));return r.clone=this.clone,r}}}var K=Z();function j(e){this.rules=null,this._messages=K,this.define(e)}j.prototype={messages:function(r){return r&&(this._messages=Q(Z(),r)),this._messages},define:function(r){if(!r)throw new Error("Cannot configure a schema with no rules");if(typeof r!="object"||Array.isArray(r))throw new Error("Rules must be an object");this.rules={};var n,t;for(n in r)r.hasOwnProperty(n)&&(t=r[n],this.rules[n]=Array.isArray(t)?t:[t])},validate:function(r,n,t){var i=this;n===void 0&&(n={}),t===void 0&&(t=function(){});var f=r,a=n,u=t;if(typeof a=="function"&&(u=a,a={}),!this.rules||Object.keys(this.rules).length===0)return u&&u(),Promise.resolve();function O(o){var g,s=[],F={};function D(q){if(Array.isArray(q)){var l;s=(l=s).concat.apply(l,q)}else s.push(q)}for(g=0;g<o.length;g++)D(o[g]);s.length?F=J(s):(s=null,F=null),u(s,F)}if(a.messages){var p=this.messages();p===K&&(p=Z()),Q(p,a.messages),a.messages=p}else a.messages=this.messages();var m,h,w={},x=a.keys||Object.keys(this.rules);x.forEach(function(o){m=i.rules[o],h=f[o],m.forEach(function(g){var s=g;typeof s.transform=="function"&&(f===r&&(f=E({},f)),h=f[o]=s.transform(h)),typeof s=="function"?s={validator:s}:s=E({},s),s.validator=i.getValidationMethod(s),s.field=o,s.fullField=s.fullField||o,s.type=i.getType(s),!!s.validator&&(w[o]=w[o]||[],w[o].push({rule:s,value:h,source:f,field:o}))})});var P={};return se(w,a,function(o,g){var s=o.rule,F=(s.type==="object"||s.type==="array")&&(typeof s.fields=="object"||typeof s.defaultField=="object");F=F&&(s.required||!s.required&&o.value),s.field=o.field;function D(A,c){return E({},c,{fullField:s.fullField+"."+A})}function q(A){A===void 0&&(A=[]);var c=A;if(Array.isArray(c)||(c=[c]),!a.suppressWarning&&c.length&&j.warning("async-validator:",c),c.length&&s.message!==void 0&&(c=[].concat(s.message)),c=c.map(I(s)),a.first&&c.length)return P[s.field]=1,g(c);if(!F)g(c);else{if(s.required&&!o.value)return s.message!==void 0?c=[].concat(s.message).map(I(s)):a.error&&(c=[a.error(s,v(a.messages.required,s.field))]),g(c);var b={};if(s.defaultField)for(var Y in o.value)o.value.hasOwnProperty(Y)&&(b[Y]=s.defaultField);b=E({},b,o.rule.fields);for(var _ in b)if(b.hasOwnProperty(_)){var C=Array.isArray(b[_])?b[_]:[b[_]];b[_]=C.map(D.bind(null,_))}var z=new j(b);z.messages(a.messages),o.rule.options&&(o.rule.options.messages=a.messages,o.rule.options.error=a.error),z.validate(o.value,o.rule.options||a,function(S){var N=[];c&&c.length&&N.push.apply(N,c),S&&S.length&&N.push.apply(N,S),g(N.length?N:null)})}}var l;s.asyncValidator?l=s.asyncValidator(s,o.value,q,o.source,a):s.validator&&(l=s.validator(s,o.value,q,o.source,a),l===!0?q():l===!1?q(s.message||s.field+" fails"):l instanceof Array?q(l):l instanceof Error&&q(l.message)),l&&l.then&&l.then(function(){return q()},function(A){return q(A)})},function(o){O(o)})},getType:function(r){if(r.type===void 0&&r.pattern instanceof RegExp&&(r.type="pattern"),typeof r.validator!="function"&&r.type&&!V.hasOwnProperty(r.type))throw new Error(v("Unknown rule type %s",r.type));return r.type||"string"},getValidationMethod:function(r){if(typeof r.validator=="function")return r.validator;var n=Object.keys(r),t=n.indexOf("message");return t!==-1&&n.splice(t,1),n.length===1&&n[0]==="required"?V.required:V[this.getType(r)]||!1}};j.register=function(r,n){if(typeof n!="function")throw new Error("Cannot register a validator by type, validator is not a function");V[r]=n};j.warning=ne;j.messages=K;j.validators=V;export{j as S};
